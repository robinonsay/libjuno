<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LibJuno: LibJuno Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
  </script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeFragmentCopyButton.init()
  </script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeParagraphLink.init()
  </script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init()
  </script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeTabs.init()
  </script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2K3RX3SR87"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2K3RX3SR87');
  </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="juno_logo_1.svg"/></td>
  <td id="projectalign">
   <div id="projectname">LibJuno<span id="projectnumber">&#160;1.1.1</span>
   </div>
   <div id="projectbrief">LibJuno is a lightweight C11 library designed specifically for embedded systems.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__2home_2runner_2work_2libjuno_2libjuno_2examples_2example__project_2LibJuno__Tutorial.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">LibJuno Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md75"></a> </p>
<h1><a class="anchor" id="autotoc_md76"></a>
main.c</h1>
<p>The purpose of this tutorial is to show new users how to use LibJuno as a embedded software micro-framework. LibJuno is intended to provide developers and software architects the freedom to implement their software system according to their use case, instead of users conforming to our library.</p>
<p>This means users will need to define their own entry point. On systems with an OS, this would be a main function.</p>
<p>Additionally, users will need to implement project specific functions like logging and time management since LibJuno doesn't assume your OS or time use-case.</p>
<h2><a class="anchor" id="autotoc_md77"></a>
Logging</h2>
<p>In this case, we are going to implement the logging functions using <code>printf</code>. A fixed size buffer is utilized with <code>vsnprintf</code> to ensure the logger doesn't see any memory overruns.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="main_8c.html#ae3acb5446cc3d129a21c2d00863399cc">LogDebug</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptJunoLog, <span class="keyword">const</span> <span class="keywordtype">char</span> *pcMsg, ...)</div>
<div class="line">{</div>
<div class="line">    (void) ptJunoLog;</div>
<div class="line">    va_list tVarg;</div>
<div class="line">    va_start(tVarg, pcMsg);</div>
<div class="line">    <span class="keywordtype">char</span> pcPrintStr[512] = {0};</div>
<div class="line">    vsnprintf(pcPrintStr, <span class="keyword">sizeof</span>(pcPrintStr), pcMsg, tVarg);</div>
<div class="line">    printf(<span class="stringliteral">&quot;DEBUG: %s\n&quot;</span>, pcPrintStr);</div>
<div class="line">    va_end(tVarg);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="main_8c.html#afdf60c17632e976e381e981f5c019c01">LogInfo</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptJunoLog, <span class="keyword">const</span> <span class="keywordtype">char</span> *pcMsg, ...)</div>
<div class="line">{</div>
<div class="line">    (void) ptJunoLog;</div>
<div class="line">    va_list tVarg;</div>
<div class="line">    va_start(tVarg, pcMsg);</div>
<div class="line">    <span class="keywordtype">char</span> pcPrintStr[512] = {0};</div>
<div class="line">    vsnprintf(pcPrintStr, <span class="keyword">sizeof</span>(pcPrintStr), pcMsg, tVarg);</div>
<div class="line">    printf(<span class="stringliteral">&quot;INFO: %s\n&quot;</span>, pcPrintStr);</div>
<div class="line">    va_end(tVarg);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="main_8c.html#a1952bfaed98132c9bbf0e27e30cd4fb3">LogWarning</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptJunoLog, <span class="keyword">const</span> <span class="keywordtype">char</span> *pcMsg, ...)</div>
<div class="line">{</div>
<div class="line">    (void) ptJunoLog;</div>
<div class="line">    va_list tVarg;</div>
<div class="line">    va_start(tVarg, pcMsg);</div>
<div class="line">    <span class="keywordtype">char</span> pcPrintStr[512] = {0};</div>
<div class="line">    vsnprintf(pcPrintStr, <span class="keyword">sizeof</span>(pcPrintStr), pcMsg, tVarg);</div>
<div class="line">    printf(<span class="stringliteral">&quot;WARN: %s\n&quot;</span>, pcPrintStr);</div>
<div class="line">    va_end(tVarg);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="main_8c.html#a4c5799027873b5e412bbc794bd2cad2a">LogError</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptJunoLog, <span class="keyword">const</span> <span class="keywordtype">char</span> *pcMsg, ...)</div>
<div class="line">{</div>
<div class="line">    (void) ptJunoLog;</div>
<div class="line">    va_list tVarg;</div>
<div class="line">    va_start(tVarg, pcMsg);</div>
<div class="line">    <span class="keywordtype">char</span> pcPrintStr[512] = {0};</div>
<div class="line">    vsnprintf(pcPrintStr, <span class="keyword">sizeof</span>(pcPrintStr), pcMsg, tVarg);</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: %s\n&quot;</span>, pcPrintStr);</div>
<div class="line">    va_end(tVarg);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__juno__status__codes_html_gad89a3ea5be5fc21a4b97e2b1e761c084"><div class="ttname"><a href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a></div><div class="ttdeci">#define JUNO_STATUS_SUCCESS</div><div class="ttdoc">Operation completed successfully.</div><div class="ttdef"><b>Definition</b> status.h:56</div></div>
<div class="ttc" id="agroup__juno__status_html_ga37f8e6b135f0c1a21a3a34b19d1772aa"><div class="ttname"><a href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a></div><div class="ttdeci">int32_t JUNO_STATUS_T</div><div class="ttdoc">Canonical status type for LibJuno functions.</div><div class="ttdef"><b>Definition</b> status.h:49</div></div>
<div class="ttc" id="alog__api_8h_html_a006301174348e71fde021a376106f756"><div class="ttname"><a href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a></div><div class="ttdeci">struct JUNO_LOG_ROOT_TAG JUNO_LOG_ROOT_T</div><div class="ttdef"><b>Definition</b> log_api.h:49</div></div>
<div class="ttc" id="amain_8c_html_a1952bfaed98132c9bbf0e27e30cd4fb3"><div class="ttname"><a href="main_8c.html#a1952bfaed98132c9bbf0e27e30cd4fb3">LogWarning</a></div><div class="ttdeci">static JUNO_STATUS_T LogWarning(const JUNO_LOG_ROOT_T *ptJunoLog, const char *pcMsg,...)</div><div class="ttdef"><b>Definition</b> main.c:71</div></div>
<div class="ttc" id="amain_8c_html_a4c5799027873b5e412bbc794bd2cad2a"><div class="ttname"><a href="main_8c.html#a4c5799027873b5e412bbc794bd2cad2a">LogError</a></div><div class="ttdeci">static JUNO_STATUS_T LogError(const JUNO_LOG_ROOT_T *ptJunoLog, const char *pcMsg,...)</div><div class="ttdef"><b>Definition</b> main.c:82</div></div>
<div class="ttc" id="amain_8c_html_ae3acb5446cc3d129a21c2d00863399cc"><div class="ttname"><a href="main_8c.html#ae3acb5446cc3d129a21c2d00863399cc">LogDebug</a></div><div class="ttdeci">static JUNO_STATUS_T LogDebug(const JUNO_LOG_ROOT_T *ptJunoLog, const char *pcMsg,...)</div><div class="ttdef"><b>Definition</b> main.c:49</div></div>
<div class="ttc" id="amain_8c_html_afdf60c17632e976e381e981f5c019c01"><div class="ttname"><a href="main_8c.html#afdf60c17632e976e381e981f5c019c01">LogInfo</a></div><div class="ttdeci">static JUNO_STATUS_T LogInfo(const JUNO_LOG_ROOT_T *ptJunoLog, const char *pcMsg,...)</div><div class="ttdef"><b>Definition</b> main.c:60</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
Time</h2>
<p>In this example project we will need a timestamp, so we'll implement the <code>Now</code> function. We don't need <code>Sleep</code> or <code>SleepTo</code> so we'll provide mocks to those functions. LibJuno provides time math functions that we can utilize so we only need to provide implementations to these three time functions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> JUNO_TIMESTAMP_RESULT_T <a class="code hl_function" href="main_8c.html#a6572883ff03955261759096ae2e010f1">Now</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> *ptTime)</div>
<div class="line">{</div>
<div class="line">    JUNO_TIMESTAMP_RESULT_T tResult = {0};</div>
<div class="line">    <span class="keywordflow">if</span>(!ptTime)</div>
<div class="line">    {</div>
<div class="line">        tResult.tStatus = <a class="code hl_define" href="group__juno__status__codes.html#ga4ae7478f0e9875995d1e1430c39752ff">JUNO_STATUS_NULLPTR_ERROR</a>;</div>
<div class="line">        <span class="keywordflow">return</span> tResult;</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">struct </span>timespec tTime = {0};</div>
<div class="line">    clock_gettime(CLOCK_MONOTONIC, &amp;tTime);</div>
<div class="line">    tResult = ptTime-&gt;ptApi-&gt;NanosToTimestamp(ptTime, tTime.tv_nsec);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tResult.tStatus, <span class="keywordflow">return</span> tResult);</div>
<div class="line">    tResult.tOk.iSeconds = tTime.tv_sec;</div>
<div class="line">    <span class="keywordflow">return</span> tResult;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="main_8c.html#a333b276b4a717dcc52486e63586ca517">SleepTo</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> *ptTime, <a class="code hl_struct" href="structJUNO__TIMESTAMP__TAG.html">JUNO_TIMESTAMP_T</a> tTimeToWakeup)</div>
<div class="line">{</div>
<div class="line">    (void) ptTime;</div>
<div class="line">    (void) tTimeToWakeup;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="main_8c.html#a59d36535fea6c5303116ef1b51682761">Sleep</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> *ptTime, <a class="code hl_struct" href="structJUNO__TIMESTAMP__TAG.html">JUNO_TIMESTAMP_T</a> tDuration)</div>
<div class="line">{</div>
<div class="line">    (void) ptTime;</div>
<div class="line">    (void) tDuration;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__juno__macros_html_gaef99be367bacf32d7c30b34e43a475b3"><div class="ttname"><a href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a></div><div class="ttdeci">#define JUNO_ASSERT_SUCCESS(tStatus,...)</div><div class="ttdoc">Execute the provided failure operation(s) if status is not success.</div><div class="ttdef"><b>Definition</b> macros.h:87</div></div>
<div class="ttc" id="agroup__juno__status__codes_html_ga4ae7478f0e9875995d1e1430c39752ff"><div class="ttname"><a href="group__juno__status__codes.html#ga4ae7478f0e9875995d1e1430c39752ff">JUNO_STATUS_NULLPTR_ERROR</a></div><div class="ttdeci">#define JUNO_STATUS_NULLPTR_ERROR</div><div class="ttdoc">A required pointer argument was NULL or invalid.</div><div class="ttdef"><b>Definition</b> status.h:60</div></div>
<div class="ttc" id="agroup__juno__time_html_gaefeb9d6509263f33b8586b99ae66bcac"><div class="ttname"><a href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a></div><div class="ttdeci">struct JUNO_TIME_ROOT_TAG JUNO_TIME_ROOT_T</div><div class="ttdef"><b>Definition</b> time_api.h:69</div></div>
<div class="ttc" id="amain_8c_html_a333b276b4a717dcc52486e63586ca517"><div class="ttname"><a href="main_8c.html#a333b276b4a717dcc52486e63586ca517">SleepTo</a></div><div class="ttdeci">static JUNO_STATUS_T SleepTo(const JUNO_TIME_ROOT_T *ptTime, JUNO_TIMESTAMP_T tTimeToWakeup)</div><div class="ttdoc">Sleep this thread until a specific time.</div><div class="ttdef"><b>Definition</b> main.c:118</div></div>
<div class="ttc" id="amain_8c_html_a59d36535fea6c5303116ef1b51682761"><div class="ttname"><a href="main_8c.html#a59d36535fea6c5303116ef1b51682761">Sleep</a></div><div class="ttdeci">static JUNO_STATUS_T Sleep(const JUNO_TIME_ROOT_T *ptTime, JUNO_TIMESTAMP_T tDuration)</div><div class="ttdoc">Sleep this thread for a duration.</div><div class="ttdef"><b>Definition</b> main.c:125</div></div>
<div class="ttc" id="amain_8c_html_a6572883ff03955261759096ae2e010f1"><div class="ttname"><a href="main_8c.html#a6572883ff03955261759096ae2e010f1">Now</a></div><div class="ttdeci">static JUNO_TIMESTAMP_RESULT_T Now(const JUNO_TIME_ROOT_T *ptTime)</div><div class="ttdoc">Get the current time as specified by the implementation.</div><div class="ttdef"><b>Definition</b> main.c:102</div></div>
<div class="ttc" id="astructJUNO__TIMESTAMP__TAG_html"><div class="ttname"><a href="structJUNO__TIMESTAMP__TAG.html">JUNO_TIMESTAMP_TAG</a></div><div class="ttdoc">Timestamp consisting of whole seconds and fixed-point subseconds.</div><div class="ttdef"><b>Definition</b> time_api.h:105</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md79"></a>
Instantiating APIs</h2>
<p>LibJuno utilizes a vtable, or a table of function pointers to the specific implementation, that is passed to the LibJuno module. This vtable is called an "API" in LibJuno nomenclature and it provides a standard interface to the capabilities. LibJuno is implemented as a set of capabilities, or software components that perform a set functionality. These capabilities are called "Modules" and can be extened through derivation. Additionally APIs can be extended through derivation. When a module or API is extended its called "derived".</p>
<p>Below is the API instantiation of the logger and time APIs for this project. We are providing our logging implementations and time implementations. You'll notice that the time API provides a helper macro to instantiate the API. Some APIs offer existing implementations, so a helper macro is used to inform users which functions they need to implement.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__LOG__API__TAG.html">JUNO_LOG_API_T</a> <a class="code hl_variable" href="main_8c.html#a5bc99417ed1aea4d7f1432f37d41b015">gtMyLoggerApi</a> ={</div>
<div class="line">    <a class="code hl_function" href="main_8c.html#ae3acb5446cc3d129a21c2d00863399cc">LogDebug</a>,</div>
<div class="line">    <a class="code hl_function" href="main_8c.html#afdf60c17632e976e381e981f5c019c01">LogInfo</a>,</div>
<div class="line">    <a class="code hl_function" href="main_8c.html#a1952bfaed98132c9bbf0e27e30cd4fb3">LogWarning</a>,</div>
<div class="line">    <a class="code hl_function" href="main_8c.html#a4c5799027873b5e412bbc794bd2cad2a">LogError</a></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__TIME__API__TAG.html">JUNO_TIME_API_T</a> <a class="code hl_variable" href="main_8c.html#a4acd2b68aa418cc093a2e16719229fe8">gtTimeApi</a> = <a class="code hl_define" href="group__juno__time.html#gabec94293ca1788aa3309ec29667ff83d">JunoTime_TimeApiInit</a>(<a class="code hl_function" href="main_8c.html#a6572883ff03955261759096ae2e010f1">Now</a>, <a class="code hl_function" href="main_8c.html#a333b276b4a717dcc52486e63586ca517">SleepTo</a>, <a class="code hl_function" href="main_8c.html#a59d36535fea6c5303116ef1b51682761">Sleep</a>);</div>
<div class="ttc" id="agroup__juno__time_html_gabec94293ca1788aa3309ec29667ff83d"><div class="ttname"><a href="group__juno__time.html#gabec94293ca1788aa3309ec29667ff83d">JunoTime_TimeApiInit</a></div><div class="ttdeci">#define JunoTime_TimeApiInit(Now, SleepTo, Sleep)</div><div class="ttdoc">Initialize a JUNO_TIME_API_T literal with default math/conversion impls.</div><div class="ttdef"><b>Definition</b> time_api.h:197</div></div>
<div class="ttc" id="amain_8c_html_a4acd2b68aa418cc093a2e16719229fe8"><div class="ttname"><a href="main_8c.html#a4acd2b68aa418cc093a2e16719229fe8">gtTimeApi</a></div><div class="ttdeci">static const JUNO_TIME_API_T gtTimeApi</div><div class="ttdef"><b>Definition</b> main.c:153</div></div>
<div class="ttc" id="amain_8c_html_a5bc99417ed1aea4d7f1432f37d41b015"><div class="ttname"><a href="main_8c.html#a5bc99417ed1aea4d7f1432f37d41b015">gtMyLoggerApi</a></div><div class="ttdeci">static const JUNO_LOG_API_T gtMyLoggerApi</div><div class="ttdef"><b>Definition</b> main.c:146</div></div>
<div class="ttc" id="astructJUNO__LOG__API__TAG_html"><div class="ttname"><a href="structJUNO__LOG__API__TAG.html">JUNO_LOG_API_TAG</a></div><div class="ttdef"><b>Definition</b> log_api.h:54</div></div>
<div class="ttc" id="astructJUNO__TIME__API__TAG_html"><div class="ttname"><a href="structJUNO__TIME__API__TAG.html">JUNO_TIME_API_TAG</a></div><div class="ttdoc">Vtable for time operations and conversions.</div><div class="ttdef"><b>Definition</b> time_api.h:128</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md80"></a>
Failure Handler</h2>
<p>LibJuno utilizes a failure handler callback. This is a function that is automatically called by downstream code when a failure occurs. In an embedded system, you might not have a terminal or console log running. This enables developers to have a single implementation and methodology for handling failure within the software. The <code>JUNO_FAIL...</code> macros will automatically call the failure handler if one is provided.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8c.html#a84de8879512b8301c09f2806d8e6c287">FailureHandler</a>(<a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus, <span class="keyword">const</span> <span class="keywordtype">char</span> *pcMsg, <a class="code hl_typedef" href="group__juno__status.html#gaf575dc984c80091757afe42a5d5c2b60">JUNO_USER_DATA_T</a> *pvUserData)</div>
<div class="line">{</div>
<div class="line">    (void) pvUserData;</div>
<div class="line">    printf(<span class="stringliteral">&quot;FAILURE: %u | %s\n&quot;</span>, tStatus, pcMsg);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__juno__status_html_gaf575dc984c80091757afe42a5d5c2b60"><div class="ttname"><a href="group__juno__status.html#gaf575dc984c80091757afe42a5d5c2b60">JUNO_USER_DATA_T</a></div><div class="ttdeci">void JUNO_USER_DATA_T</div><div class="ttdoc">Opaque user data type for failure callbacks.</div><div class="ttdef"><b>Definition</b> status.h:96</div></div>
<div class="ttc" id="amain_8c_html_a84de8879512b8301c09f2806d8e6c287"><div class="ttname"><a href="main_8c.html#a84de8879512b8301c09f2806d8e6c287">FailureHandler</a></div><div class="ttdeci">void FailureHandler(JUNO_STATUS_T tStatus, const char *pcMsg, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdef"><b>Definition</b> main.c:163</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md81"></a>
The Entry Point</h2>
<p>This example project assumes its running on a POSIX system. Therefore, we can use a main method as the entry point. Many microcontrollers have different architectures for their entry point so you'll need to consult with your architecture documentation on how to implement the entry point.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="ttc" id="amain_8c_html_a840291bc02cba5474a4cb46a9b9566fe"><div class="ttname"><a href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a></div><div class="ttdeci">int main(void)</div><div class="ttdef"><b>Definition</b> main.c:176</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md82"></a>
Dependency Injection in Action</h2>
<p>The core principle of dependency injection is "inversion of control". This is a fancy term for saying that modules don't allocate resources, up stream users do. This is done at the "composition root", or the spot in the code where all the dependencies get implemented. In this case, the main function is the composition root. Here we need to instantiate the time, logger, registry modules.</p>
<p>Applications in LibJuno are actually derived modules of <code>JUNO_APP_ROOT_T</code>. Here we will need to instantiate the engine, and system manager application modules.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> tTime = {0};</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> tLogger = {0};</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="broker__api_8h.html#abd1ae51793446030c54d77cce75edce2">JUNO_SB_PIPE_T</a> *tRegistry[10] = {0};</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="broker__api_8h.html#a18f8e3cdde5d600227ecc8fae74e1dd2">JUNO_SB_BROKER_ROOT_T</a> tBroker = {0};</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> tEngineApp = {0};</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="system__manager__app_8h.html#a79897d760b6d1d07f9735a4b05dba248">SYSTEM_MANAGER_APP_T</a> tSystemManagerApp = {0};</div>
<div class="ttc" id="abroker__api_8h_html_a18f8e3cdde5d600227ecc8fae74e1dd2"><div class="ttname"><a href="broker__api_8h.html#a18f8e3cdde5d600227ecc8fae74e1dd2">JUNO_SB_BROKER_ROOT_T</a></div><div class="ttdeci">struct JUNO_SB_BROKER_ROOT_TAG JUNO_SB_BROKER_ROOT_T</div><div class="ttdef"><b>Definition</b> broker_api.h:65</div></div>
<div class="ttc" id="abroker__api_8h_html_abd1ae51793446030c54d77cce75edce2"><div class="ttname"><a href="broker__api_8h.html#abd1ae51793446030c54d77cce75edce2">JUNO_SB_PIPE_T</a></div><div class="ttdeci">struct JUNO_SB_PIPE_TAG JUNO_SB_PIPE_T</div><div class="ttdef"><b>Definition</b> broker_api.h:67</div></div>
<div class="ttc" id="aengine__app_8h_html_adfc71973e68539e8461689f81271a2e8"><div class="ttname"><a href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a></div><div class="ttdeci">struct ENGINE_APP_TAG ENGINE_APP_T</div><div class="ttdef"><b>Definition</b> engine_app.h:80</div></div>
<div class="ttc" id="asystem__manager__app_8h_html_a79897d760b6d1d07f9735a4b05dba248"><div class="ttname"><a href="system__manager__app_8h.html#a79897d760b6d1d07f9735a4b05dba248">SYSTEM_MANAGER_APP_T</a></div><div class="ttdeci">struct SYSTEM_MANAGER_APP_TAG SYSTEM_MANAGER_APP_T</div><div class="ttdef"><b>Definition</b> system_manager_app.h:43</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md83"></a>
Module Initialization</h2>
<p>Modules typically have an <code>Init</code> function that specifies the required fields to initialize a module. Modules also utilize a <code>Verify</code> function to verify they've been initialzed. Most modules will return a <code>JUNO_STATUS_NULLPTR_ERROR</code> if they have not been initalized and a function has been called on them.</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_function" href="group__juno__time.html#ga7fa3a14d573be73b596317de7b4fb8ef">JunoTime_TimeInit</a>(&amp;tTime, &amp;<a class="code hl_variable" href="main_8c.html#a4acd2b68aa418cc093a2e16719229fe8">gtTimeApi</a>, <a class="code hl_function" href="main_8c.html#a84de8879512b8301c09f2806d8e6c287">FailureHandler</a>, NULL);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> -1);</div>
<div class="line">tStatus = <a class="code hl_function" href="log__api_8h.html#af8ae701345827e12c21e2547c1a230d2">JunoLog_LogInit</a>(&amp;tLogger, &amp;<a class="code hl_variable" href="main_8c.html#a5bc99417ed1aea4d7f1432f37d41b015">gtMyLoggerApi</a>, <a class="code hl_function" href="main_8c.html#a84de8879512b8301c09f2806d8e6c287">FailureHandler</a>, NULL);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> -1);</div>
<div class="ttc" id="agroup__juno__time_html_ga7fa3a14d573be73b596317de7b4fb8ef"><div class="ttname"><a href="group__juno__time.html#ga7fa3a14d573be73b596317de7b4fb8ef">JunoTime_TimeInit</a></div><div class="ttdeci">static JUNO_STATUS_T JunoTime_TimeInit(JUNO_TIME_ROOT_T *ptTime, const JUNO_TIME_API_T *ptApi, JUNO_FAILURE_HANDLER_T pfcnFailureHandler, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdoc">Initialize the time module root with API and failure handler.</div><div class="ttdef"><b>Definition</b> time_api.h:233</div></div>
<div class="ttc" id="alog__api_8h_html_af8ae701345827e12c21e2547c1a230d2"><div class="ttname"><a href="log__api_8h.html#af8ae701345827e12c21e2547c1a230d2">JunoLog_LogInit</a></div><div class="ttdeci">static JUNO_STATUS_T JunoLog_LogInit(JUNO_LOG_ROOT_T *ptLog, const JUNO_LOG_API_T *ptApi, JUNO_FAILURE_HANDLER_T pfcnFailureHandler, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdoc">Initialize a log instance with an API implementation and failure handler.</div><div class="ttdef"><b>Definition</b> log_api.h:66</div></div>
</div><!-- fragment --><p>Notice how the broker, engine, and system manager take initialized modules as dependencies to their initialization. This is DI in action. For example, the engine app is provided with a logger, time, and broker instead of instantiating it itself.</p>
<div class="fragment"><div class="line">tStatus = <a class="code hl_function" href="broker__api_8h.html#a9409bfb642a1118e6b427580177aa4dc">JunoSb_BrokerInit</a>(&amp;tBroker, tRegistry, 10, <a class="code hl_function" href="main_8c.html#a84de8879512b8301c09f2806d8e6c287">FailureHandler</a>, NULL);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> -1);</div>
<div class="line">tStatus = <a class="code hl_function" href="engine__app_8h.html#ac02e2300210188645a8b0fa95c8223d7">EngineApp_Init</a>(&amp;tEngineApp, &amp;tLogger, &amp;tTime, &amp;tBroker, <a class="code hl_function" href="main_8c.html#a84de8879512b8301c09f2806d8e6c287">FailureHandler</a>, NULL);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> -1);</div>
<div class="line">tStatus = <a class="code hl_function" href="system__manager__app_8h.html#ab5b6e9a648ac371b7bed504ad35b492a">SystemManagerApp</a>(&amp;tSystemManagerApp, &amp;tLogger, &amp;tTime, &amp;tBroker, <a class="code hl_function" href="main_8c.html#a84de8879512b8301c09f2806d8e6c287">FailureHandler</a>, NULL);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> -1);</div>
<div class="ttc" id="abroker__api_8h_html_a9409bfb642a1118e6b427580177aa4dc"><div class="ttname"><a href="broker__api_8h.html#a9409bfb642a1118e6b427580177aa4dc">JunoSb_BrokerInit</a></div><div class="ttdeci">JUNO_STATUS_T JunoSb_BrokerInit(JUNO_SB_BROKER_ROOT_T *ptBroker, JUNO_SB_PIPE_T **ptPipeRegistry, size_t iRegistryCapacity, JUNO_FAILURE_HANDLER_T pfcnFailureHdlr, JUNO_USER_DATA_T *pvFailureUserData)</div><div class="ttdoc">Initialize a broker with a pipe registry storage array.</div><div class="ttdef"><b>Definition</b> juno_broker.c:35</div></div>
<div class="ttc" id="aengine__app_8h_html_ac02e2300210188645a8b0fa95c8223d7"><div class="ttname"><a href="engine__app_8h.html#ac02e2300210188645a8b0fa95c8223d7">EngineApp_Init</a></div><div class="ttdeci">JUNO_STATUS_T EngineApp_Init(ENGINE_APP_T *ptEngineApp, const JUNO_LOG_ROOT_T *ptLogger, const JUNO_TIME_ROOT_T *ptTime, JUNO_SB_BROKER_ROOT_T *ptBroker, JUNO_FAILURE_HANDLER_T pfcnFailureHandler, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdef"><b>Definition</b> engine_app.c:106</div></div>
<div class="ttc" id="asystem__manager__app_8h_html_ab5b6e9a648ac371b7bed504ad35b492a"><div class="ttname"><a href="system__manager__app_8h.html#ab5b6e9a648ac371b7bed504ad35b492a">SystemManagerApp</a></div><div class="ttdeci">JUNO_STATUS_T SystemManagerApp(SYSTEM_MANAGER_APP_T *ptSystemManagerApp, JUNO_LOG_ROOT_T *ptLogger, JUNO_TIME_ROOT_T *ptTime, JUNO_SB_BROKER_ROOT_T *ptBroker, JUNO_FAILURE_HANDLER_T pfcnFailureHandler, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdef"><b>Definition</b> system_manager_app.c:70</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md84"></a>
Runtime</h2>
<p>For this example we are going to create a very simple "schedule table" or table of applications that will run in a specific order. This schedule table will run at best-effort. This means that when one application is done, the next will start.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptAppList[2] = {</div>
<div class="line">    &amp;tSystemManagerApp.tRoot,</div>
<div class="line">    &amp;tEngineApp.tRoot</div>
<div class="line">};</div>
<div class="ttc" id="aapp__api_8h_html_af4d1371636773a3186696687c684db54"><div class="ttname"><a href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a></div><div class="ttdeci">struct JUNO_APP_ROOT_TAG JUNO_APP_ROOT_T</div><div class="ttdoc">The application module.</div><div class="ttdef"><b>Definition</b> app_api.h:50</div></div>
</div><!-- fragment --><p>Since all applications have the same interface, we can run their init function in a for-loop and run the application <code>OnProcess</code> function in a <code>while(true)</code> loop.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; 2; i++)</div>
<div class="line">    {</div>
<div class="line">        tStatus = ptAppList[i]-&gt;ptApi-&gt;OnStart(ptAppList[i]);</div>
<div class="line">        <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> -1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">size_t</span> iCounter = 0;</div>
<div class="line">    <span class="keywordflow">while</span>(<span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">        ptAppList[iCounter]-&gt;ptApi-&gt;OnProcess(ptAppList[iCounter]);</div>
<div class="line">        iCounter = (iCounter + 1) % 2;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md85"></a>
engine_app.h</h1>
<h2><a class="anchor" id="autotoc_md86"></a>
The Engine Application</h2>
<p>Next we will be going over a typical LibJuno application. For this tutorial project we are defining an engine application that manages the engine hardware for our car. In this example the engine needs to receive a command for the RPM and telemeter the actual RPM of the engine.</p>
<h1><a class="anchor" id="autotoc_md87"></a>
Deriving an Application</h1>
<p>Applications in LibJuno are derived from the application root. This provides a common API for applications to utilize. A standard application has three lifecycle functions:</p><ol type="1">
<li>OnStart: The first function called in the application. It is called only once at the beginning of the application lifecycle. This is where developers would initialize resources that will be utilized by the application</li>
<li>OnProcess: This is the "main run-loop" function of the application. This function is called by the main run-time in a loop and is the primary run function of the app.</li>
<li>OnExit: This is the last function called by the application. This is where developers would clean up resources allocated by the application. A typical runtime would call application exit functions when the software is closing.</li>
</ol>
<h1><a class="anchor" id="autotoc_md88"></a>
The Application Structure</h1>
<p>Within the derived application users are expected to place pointers to dependencies they require from the main runtime and hold resources the application needs to own and pass from one lifecycle event to the next. In this case the engine app needs the following from the runtime:</p><ul>
<li>Logger</li>
<li>Time</li>
<li>Broker</li>
</ul>
<p>And the application needs to allocate:</p><ul>
<li>A command buffer for engine commands. This is a memory allocation for commands that will be received by the application</li>
<li>A command pipe. This is the module that manages the command buffer</li>
<li>The current RPM. This is the current state of our engine.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>ENGINE_APP_TAG <a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a>;</div>
<div class="line"><span class="preprocessor">#define ENGINE_CMD_MSG_PIPE_DEPTH   (1)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ENGINE_APP_TAG <a class="code hl_define" href="group__juno__module.html#gad75a2500587693c7790d082005932ffc">JUNO_MODULE_DERIVE</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a>,</div>
<div class="line">    const <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptLogger;</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> *ptTime;</div>
<div class="line">    <a class="code hl_typedef" href="broker__api_8h.html#a18f8e3cdde5d600227ecc8fae74e1dd2">JUNO_SB_BROKER_ROOT_T</a> *ptBroker;</div>
<div class="line">    <a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> ptArrCmdBuffer[<a class="code hl_define" href="engine__app_8h.html#a6528d7a500b07e3c59309ecb7406beb8">ENGINE_CMD_MSG_PIPE_DEPTH</a>];</div>
<div class="line">    ENGINE_CMD_MSG_ARRAY_T tCmdArray;</div>
<div class="line">    <a class="code hl_typedef" href="broker__api_8h.html#abd1ae51793446030c54d77cce75edce2">JUNO_SB_PIPE_T</a> tCmdPipe;</div>
<div class="line">    <span class="keywordtype">float</span> fCurrentRpm;</div>
<div class="line">);</div>
<div class="ttc" id="aengine__app_8h_html_a6528d7a500b07e3c59309ecb7406beb8"><div class="ttname"><a href="engine__app_8h.html#a6528d7a500b07e3c59309ecb7406beb8">ENGINE_CMD_MSG_PIPE_DEPTH</a></div><div class="ttdeci">#define ENGINE_CMD_MSG_PIPE_DEPTH</div><div class="ttdef"><b>Definition</b> engine_app.h:81</div></div>
<div class="ttc" id="agroup__juno__module_html_gad75a2500587693c7790d082005932ffc"><div class="ttname"><a href="group__juno__module.html#gad75a2500587693c7790d082005932ffc">JUNO_MODULE_DERIVE</a></div><div class="ttdeci">#define JUNO_MODULE_DERIVE(ROOT_T,...)</div><div class="ttdoc">Implement a derived module embedding the root as the first member.</div><div class="ttdef"><b>Definition</b> module.h:157</div></div>
<div class="ttc" id="astructENGINE__CMD__MSG__TAG_html"><div class="ttname"><a href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_TAG</a></div><div class="ttdef"><b>Definition</b> engine_cmd_msg.h:53</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md89"></a>
The App Init Function</h3>
<p>The application also needs to provide a concrete application initialization function. This function sets dependencies and the API pointers within the application. The application has an internal "Verify" function that checks if any of these dependencies are null.</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8h.html#ac02e2300210188645a8b0fa95c8223d7">EngineApp_Init</a>(<a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *ptEngineApp, <span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptLogger, <span class="keyword">const</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> *ptTime, <a class="code hl_typedef" href="broker__api_8h.html#a18f8e3cdde5d600227ecc8fae74e1dd2">JUNO_SB_BROKER_ROOT_T</a> *ptBroker, <a class="code hl_typedef" href="group__juno__status.html#ga0fbff8c7db15c2f4d01e82b8a863dbbc">JUNO_FAILURE_HANDLER_T</a> pfcnFailureHandler, <a class="code hl_typedef" href="group__juno__status.html#gaf575dc984c80091757afe42a5d5c2b60">JUNO_USER_DATA_T</a> *pvUserData);</div>
<div class="ttc" id="agroup__juno__status_html_ga0fbff8c7db15c2f4d01e82b8a863dbbc"><div class="ttname"><a href="group__juno__status.html#ga0fbff8c7db15c2f4d01e82b8a863dbbc">JUNO_FAILURE_HANDLER_T</a></div><div class="ttdeci">void(* JUNO_FAILURE_HANDLER_T)(JUNO_STATUS_T tStatus, const char *pcCustomMessage, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdoc">Failure handler callback signature.</div><div class="ttdef"><b>Definition</b> status.h:104</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md90"></a>
engine_cmd_msg.h</h1>
<p>This file is auto-generated from a LibJuno script (scripts/create_msg.py). Similarly the <a class="el" href="engine__tlm__msg_8h.html">engine_tlm_msg.h</a> and <a class="el" href="engine__tlm__msg_8c.html">engine_tlm_msg.c</a> files are also auto-generated. We will only go over the command file since it's identical to the telemetry file in terms of architecture.</p>
<h2><a class="anchor" id="autotoc_md91"></a>
Engine Application Commands</h2>
<p>In LibJuno the software bus is operated on a single thread. A single broker is implemented for each thread of execution and the broker distributes messages to various queues that are subscribed on the software bus. These queues are called pipes. Pipes are derived LibJuno queues with a message ID subscription.</p>
<p>The message ID is a unique identifier for the type of message. Each message type will have its own message ID. In this example the engine command MID is <code>0x1800</code>. This number can be arbitrary. The only requirement is the MIDs are unique for every message type.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define ENGINE_CMD_MSG_MID            (0x1800)</span></div>
</div><!-- fragment --><p>The command message contains the RPM. Another application can send this command on the software bus and tell the engine what RPM it should be set to. The engine app will then control the engine so it's set to the new RPM.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_TAG</a></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">float</span> <a class="code hl_variable" href="structENGINE__CMD__MSG__TAG.html#ade3188a8fb0c5c7cbd0a058e48b0f115">fRpm</a>;</div>
<div class="line">} <a class="code hl_typedef" href="engine__cmd__msg_8h.html#ab1bb582288369e580705e8b6e0a3d93f">ENGINE_CMD_MSG_T</a>;</div>
<div class="ttc" id="aengine__cmd__msg_8h_html_ab1bb582288369e580705e8b6e0a3d93f"><div class="ttname"><a href="engine__cmd__msg_8h.html#ab1bb582288369e580705e8b6e0a3d93f">ENGINE_CMD_MSG_T</a></div><div class="ttdeci">struct ENGINE_CMD_MSG_TAG ENGINE_CMD_MSG_T</div></div>
<div class="ttc" id="astructENGINE__CMD__MSG__TAG_html_ade3188a8fb0c5c7cbd0a058e48b0f115"><div class="ttname"><a href="structENGINE__CMD__MSG__TAG.html#ade3188a8fb0c5c7cbd0a058e48b0f115">ENGINE_CMD_MSG_TAG::fRpm</a></div><div class="ttdeci">float fRpm</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.h:54</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md92"></a>
Engine Command Pipe</h2>
<p>Below is the definition for the engine command pipe. This is derived from the <code>JUNO_SB_PIPE_T</code> using the <code>DERIVE_WITH_API</code> macro. This macro enables users to specify which API they are using. The inheritance for a pipe is as follows: </p><div class="fragment"><div class="line">JUNO_DS_ARRAY_ROOT_T -&gt; JUNO_DS_QUEUE_ROOT_T -&gt; JUNO_SB_PIPE_T -&gt; Custom Pipe Type</div>
</div><!-- fragment --><p> Because this is a longer chain of inheritance, it's convenient to specify the API for ease-of-use. In this case we are specifying the QUEUE api.</p>
<p>The pipe holds a pointer to a command buffer, which is specific to the command message type defined earlier. This enables the derived pipe to have specific type information (vs using a void pointer in the pipe).</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>ENGINE_CMD_MSG_ARRAY_TAG <a class="code hl_define" href="group__juno__module.html#gad75a2500587693c7790d082005932ffc">JUNO_MODULE_DERIVE</a>(<a class="code hl_typedef" href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a>,</div>
<div class="line">    <a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> *ptArrEngineCmdMsgBuffer;</div>
<div class="line">) ENGINE_CMD_MSG_ARRAY_T;</div>
<div class="ttc" id="aarray__api_8h_html_a41c3dcd3aa4c045b5ca6794251257183"><div class="ttname"><a href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a></div><div class="ttdeci">struct JUNO_DS_ARRAY_ROOT_TAG JUNO_DS_ARRAY_ROOT_T</div><div class="ttdoc">Opaque array root carrying capacity and API pointer.</div><div class="ttdef"><b>Definition</b> array_api.h:58</div></div>
</div><!-- fragment --><p>The queue api relies on LibJuno pointers. This enables the modules to write generic code safely without specific type information. As a result, we need to specify a pointer API implementation for this command type.</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__POINTER__API__TAG.html">JUNO_POINTER_API_T</a> <a class="code hl_variable" href="engine__cmd__msg_8h.html#aea9c2ee7031b2418ca8a4f8b881ffd11">gtEngineCmdMsgPointerApi</a>;</div>
<div class="ttc" id="aengine__cmd__msg_8h_html_aea9c2ee7031b2418ca8a4f8b881ffd11"><div class="ttname"><a href="engine__cmd__msg_8h.html#aea9c2ee7031b2418ca8a4f8b881ffd11">gtEngineCmdMsgPointerApi</a></div><div class="ttdeci">const JUNO_POINTER_API_T gtEngineCmdMsgPointerApi</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:50</div></div>
<div class="ttc" id="astructJUNO__POINTER__API__TAG_html"><div class="ttname"><a href="structJUNO__POINTER__API__TAG.html">JUNO_POINTER_API_TAG</a></div><div class="ttdoc">Pointer operations API (copy/reset).</div><div class="ttdef"><b>Definition</b> pointer_api.h:74</div></div>
</div><!-- fragment --><p>We also define convenience macros for initializing and verifying this type of pointer. This makes working with LibJuno pointers easy.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define EngineCmdMsg_PointerInit(addr) JunoMemory_PointerInit(&amp;gtEngineCmdMsgPointerApi, ENGINE_CMD_MSG_T, addr)</span></div>
<div class="line"><span class="preprocessor">#define EngineCmdMsg_PointerVerify(tPointer) JunoMemory_PointerVerifyType(tPointer, ENGINE_CMD_MSG_T, gtEngineCmdMsgPointerApi)</span></div>
</div><!-- fragment --><p>Finally we define a Pipe Init function for this pipe type. This function will initialize the pipe with the message buffer and capacity.</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8h.html#aed9dcce9c4c3393aebc522a2d5bd4d68">EngineCmdMsg_ArrayInit</a>(ENGINE_CMD_MSG_ARRAY_T *ptEngineCmdMsgPipe, <a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> *ptArrEngineCmdMsgBuffer, <span class="keywordtype">size_t</span> iCapacity, <a class="code hl_typedef" href="group__juno__status.html#ga0fbff8c7db15c2f4d01e82b8a863dbbc">JUNO_FAILURE_HANDLER_T</a> pfcnFailureHdlr, <a class="code hl_typedef" href="group__juno__status.html#gaf575dc984c80091757afe42a5d5c2b60">JUNO_USER_DATA_T</a> *pvUserData);</div>
<div class="ttc" id="aengine__cmd__msg_8h_html_aed9dcce9c4c3393aebc522a2d5bd4d68"><div class="ttname"><a href="engine__cmd__msg_8h.html#aed9dcce9c4c3393aebc522a2d5bd4d68">EngineCmdMsg_ArrayInit</a></div><div class="ttdeci">JUNO_STATUS_T EngineCmdMsg_ArrayInit(ENGINE_CMD_MSG_ARRAY_T *ptEngineCmdMsgPipe, ENGINE_CMD_MSG_T *ptArrEngineCmdMsgBuffer, size_t iCapacity, JUNO_FAILURE_HANDLER_T pfcnFailureHdlr, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:111</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md93"></a>
engine_cmd_msg.c</h1>
<h2><a class="anchor" id="autotoc_md94"></a>
Engine Command Pipe Implementation</h2>
<p>In <code>.c</code> source file we will need to implement the following functions for the pointer and queue api:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#aaee92f68b63b79bcbf881515940c51dc">EngineCmdMsg_Copy</a>(<a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tDest, <span class="keyword">const</span> <a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tSrc);</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#aa67eeeb326a7453934757c8c334e190c">EngineCmdMsg_Reset</a>(<a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tPointer);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#a3a269b4617f04bafdc1bf76c11eb20cd">SetAt</a>(<a class="code hl_typedef" href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a> *ptArray, <a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tItem, <span class="keywordtype">size_t</span> iIndex);</div>
<div class="line"><span class="keyword">static</span> JUNO_RESULT_POINTER_T <a class="code hl_function" href="engine__cmd__msg_8c.html#a88329cf757f301650d991196efd61e6c">GetAt</a>(<a class="code hl_typedef" href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a> *ptArray, <span class="keywordtype">size_t</span> iIndex);</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#a4fe3c6e1764c332957ad42d8f0655a9f">RemoveAt</a>(<a class="code hl_typedef" href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a> *ptArray, <span class="keywordtype">size_t</span> iIndex);</div>
<div class="ttc" id="aengine__cmd__msg_8c_html_a3a269b4617f04bafdc1bf76c11eb20cd"><div class="ttname"><a href="engine__cmd__msg_8c.html#a3a269b4617f04bafdc1bf76c11eb20cd">SetAt</a></div><div class="ttdeci">static JUNO_STATUS_T SetAt(JUNO_DS_ARRAY_ROOT_T *ptArray, JUNO_POINTER_T tItem, size_t iIndex)</div><div class="ttdoc">Set the value at an index.</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:131</div></div>
<div class="ttc" id="aengine__cmd__msg_8c_html_a4fe3c6e1764c332957ad42d8f0655a9f"><div class="ttname"><a href="engine__cmd__msg_8c.html#a4fe3c6e1764c332957ad42d8f0655a9f">RemoveAt</a></div><div class="ttdeci">static JUNO_STATUS_T RemoveAt(JUNO_DS_ARRAY_ROOT_T *ptArray, size_t iIndex)</div><div class="ttdoc">Remove a value at an index.</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:176</div></div>
<div class="ttc" id="aengine__cmd__msg_8c_html_a88329cf757f301650d991196efd61e6c"><div class="ttname"><a href="engine__cmd__msg_8c.html#a88329cf757f301650d991196efd61e6c">GetAt</a></div><div class="ttdeci">static JUNO_RESULT_POINTER_T GetAt(JUNO_DS_ARRAY_ROOT_T *ptArray, size_t iIndex)</div><div class="ttdoc">Get the value at an index.</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:153</div></div>
<div class="ttc" id="aengine__cmd__msg_8c_html_aa67eeeb326a7453934757c8c334e190c"><div class="ttname"><a href="engine__cmd__msg_8c.html#aa67eeeb326a7453934757c8c334e190c">EngineCmdMsg_Reset</a></div><div class="ttdeci">static JUNO_STATUS_T EngineCmdMsg_Reset(JUNO_POINTER_T tPointer)</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:88</div></div>
<div class="ttc" id="aengine__cmd__msg_8c_html_aaee92f68b63b79bcbf881515940c51dc"><div class="ttname"><a href="engine__cmd__msg_8c.html#aaee92f68b63b79bcbf881515940c51dc">EngineCmdMsg_Copy</a></div><div class="ttdeci">static JUNO_STATUS_T EngineCmdMsg_Copy(JUNO_POINTER_T tDest, const JUNO_POINTER_T tSrc)</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:69</div></div>
<div class="ttc" id="apointer__api_8h_html_a3caf7d5b9c47228dcbb289ab1f8a6045"><div class="ttname"><a href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a></div><div class="ttdeci">struct JUNO_POINTER_TAG JUNO_POINTER_T</div><div class="ttdef"><b>Definition</b> pointer_api.h:49</div></div>
</div><!-- fragment --><p>These function will provide an interface to our specific message type and enable users to write type-safe code within LibJuno.</p>
<p>We need to forward-declare these API functions so we can use the API pointer to verify the type of the queue and pointer.</p>
<p>Below we will instantiate the pointer and pipe API tables.</p>
<div class="fragment"><div class="line"><span class="comment">// Instantiate the engine_cmd msg pointer api</span></div>
<div class="line"><span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__POINTER__API__TAG.html">JUNO_POINTER_API_T</a> <a class="code hl_variable" href="engine__cmd__msg_8h.html#aea9c2ee7031b2418ca8a4f8b881ffd11">gtEngineCmdMsgPointerApi</a> =</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="engine__cmd__msg_8c.html#aaee92f68b63b79bcbf881515940c51dc">EngineCmdMsg_Copy</a>,</div>
<div class="line">    <a class="code hl_function" href="engine__cmd__msg_8c.html#aa67eeeb326a7453934757c8c334e190c">EngineCmdMsg_Reset</a></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate the engine_cmd msg pipe api</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__DS__ARRAY__API__TAG.html">JUNO_DS_ARRAY_API_T</a> <a class="code hl_variable" href="engine__cmd__msg_8c.html#a63d8409c9ec4c299cb8ce089ef6fc642">gtEngineCmdMsgPipeApi</a> = </div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="engine__cmd__msg_8c.html#a3a269b4617f04bafdc1bf76c11eb20cd">SetAt</a>, <a class="code hl_function" href="engine__cmd__msg_8c.html#a88329cf757f301650d991196efd61e6c">GetAt</a>, <a class="code hl_function" href="engine__cmd__msg_8c.html#a4fe3c6e1764c332957ad42d8f0655a9f">RemoveAt</a></div>
<div class="line">};</div>
<div class="ttc" id="aengine__cmd__msg_8c_html_a63d8409c9ec4c299cb8ce089ef6fc642"><div class="ttname"><a href="engine__cmd__msg_8c.html#a63d8409c9ec4c299cb8ce089ef6fc642">gtEngineCmdMsgPipeApi</a></div><div class="ttdeci">static const JUNO_DS_ARRAY_API_T gtEngineCmdMsgPipeApi</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:57</div></div>
<div class="ttc" id="astructJUNO__DS__ARRAY__API__TAG_html"><div class="ttname"><a href="structJUNO__DS__ARRAY__API__TAG.html">JUNO_DS_ARRAY_API_TAG</a></div><div class="ttdoc">Array API vtable.</div><div class="ttdef"><b>Definition</b> array_api.h:75</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md95"></a>
Pointer Copy</h3>
<p>The pointer copy function is responsible for copy memory from one pointer of the same type to another. We verify the pointers are implemented and are of the same type by checking the alignment, size, and api pointer. We then dereference the pointer and copy the values since we have verified the type</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#aaee92f68b63b79bcbf881515940c51dc">EngineCmdMsg_Copy</a>(<a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tDest, <span class="keyword">const</span> <a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tSrc)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Verify the dest pointer</span></div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_define" href="engine__cmd__msg_8h.html#a81c51ba859ed61b8911125bab624baa1">EngineCmdMsg_PointerVerify</a>(tDest);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Verify the src pointer</span></div>
<div class="line">    tStatus = <a class="code hl_define" href="engine__cmd__msg_8h.html#a81c51ba859ed61b8911125bab624baa1">EngineCmdMsg_PointerVerify</a>(tSrc);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Perform the copy</span></div>
<div class="line">    *(<a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> *) tDest.pvAddr = *(<a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> *) tSrc.pvAddr;</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
<div class="ttc" id="aengine__cmd__msg_8h_html_a81c51ba859ed61b8911125bab624baa1"><div class="ttname"><a href="engine__cmd__msg_8h.html#a81c51ba859ed61b8911125bab624baa1">EngineCmdMsg_PointerVerify</a></div><div class="ttdeci">#define EngineCmdMsg_PointerVerify(tPointer)</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.h:86</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md96"></a>
Pointer Reset</h3>
<p>The reset function will reinitialize the memory of a pointer of this message type. In this case, it means setting the memory to 0. Similar to the copy function, we verify the pointer type and api before dereferencing the pointer.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#aa67eeeb326a7453934757c8c334e190c">EngineCmdMsg_Reset</a>(<a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tPointer)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Verify the pointer</span></div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_define" href="engine__cmd__msg_8h.html#a81c51ba859ed61b8911125bab624baa1">EngineCmdMsg_PointerVerify</a>(tPointer);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Perform the reset</span></div>
<div class="line">    *(<a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> *) tPointer.pvAddr = (<a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a>){0};</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md97"></a>
Pipe Api Assert</h2>
<p>We also define a macro to easily assert that the pipe type matches our implementation. This is done by checking the pipe api pointer.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define ENGINE_CMD_MSG_PIPE_ASSERT_API(ptArray, ...)  if(ptArray-&gt;ptApi != &amp;gtEngineCmdMsgPipeApi) { __VA_ARGS__; }</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md98"></a>
Pipe Init</h2>
<p>We also implement the pipe init function, which sets the API pointer as well as the message buffer and capacity.</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8h.html#aed9dcce9c4c3393aebc522a2d5bd4d68">EngineCmdMsg_ArrayInit</a>(ENGINE_CMD_MSG_ARRAY_T *ptEngineCmdMsgPipe, <a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> *ptArrEngineCmdMsgBuffer, <span class="keywordtype">size_t</span> iCapacity, <a class="code hl_typedef" href="group__juno__status.html#ga0fbff8c7db15c2f4d01e82b8a863dbbc">JUNO_FAILURE_HANDLER_T</a> pfcnFailureHdlr, <a class="code hl_typedef" href="group__juno__status.html#gaf575dc984c80091757afe42a5d5c2b60">JUNO_USER_DATA_T</a> *pvUserData)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Assert the msg pipe exists</span></div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#ga30286e0b0863a08e3a9c0151c698acc4">JUNO_ASSERT_EXISTS</a>(ptEngineCmdMsgPipe &amp;&amp; ptArrEngineCmdMsgBuffer);</div>
<div class="line">    <span class="comment">// Set the message buffer</span></div>
<div class="line">    ptEngineCmdMsgPipe-&gt;ptArrEngineCmdMsgBuffer = ptArrEngineCmdMsgBuffer;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// init the pipe</span></div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_function" href="group__juno__ds__array.html#ga9d15812b9fe37c20fb11e8829eb877d6">JunoDs_ArrayInit</a>(&amp;ptEngineCmdMsgPipe-&gt;tRoot, &amp;<a class="code hl_variable" href="engine__cmd__msg_8c.html#a63d8409c9ec4c299cb8ce089ef6fc642">gtEngineCmdMsgPipeApi</a>, iCapacity, pfcnFailureHdlr, pvUserData);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__juno__ds__array_html_ga9d15812b9fe37c20fb11e8829eb877d6"><div class="ttname"><a href="group__juno__ds__array.html#ga9d15812b9fe37c20fb11e8829eb877d6">JunoDs_ArrayInit</a></div><div class="ttdeci">static JUNO_STATUS_T JunoDs_ArrayInit(JUNO_DS_ARRAY_ROOT_T *ptArray, const JUNO_DS_ARRAY_API_T *ptArrayApi, size_t iCapacity, JUNO_FAILURE_HANDLER_T pfcnFailureHdlr, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdoc">Initialize an array root with capacity and API.</div><div class="ttdef"><b>Definition</b> array_api.h:158</div></div>
<div class="ttc" id="agroup__juno__macros_html_ga30286e0b0863a08e3a9c0151c698acc4"><div class="ttname"><a href="group__juno__macros.html#ga30286e0b0863a08e3a9c0151c698acc4">JUNO_ASSERT_EXISTS</a></div><div class="ttdeci">#define JUNO_ASSERT_EXISTS(ptr)</div><div class="ttdoc">Returns JUNO_STATUS_NULLPTR_ERROR if the expression is falsy.</div><div class="ttdef"><b>Definition</b> macros.h:50</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md99"></a>
Pipe Queue Implementation</h2>
<p>Finally we implement the <code>SetAt</code>, <code>GetAt</code>, and <code>RemoveAt</code> functions. These functions provide a type-safe interface to setting, getting, and removing values within the command buffer at specific indicies. It essentially acts as an API to the array.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#a3a269b4617f04bafdc1bf76c11eb20cd">SetAt</a>(<a class="code hl_typedef" href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a> *ptArray, <a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tItem, <span class="keywordtype">size_t</span> iIndex)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Verify the array</span></div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_function" href="group__juno__ds__array.html#gad855ed7dd372ff5fc608aee1408e3b0d">JunoDs_ArrayVerify</a>(ptArray);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Assert the api</span></div>
<div class="line">    <a class="code hl_define" href="engine__cmd__msg_8c.html#a7404ae4d7923c5f52d71f9d8d220fcd5">ENGINE_CMD_MSG_PIPE_ASSERT_API</a>(ptArray, <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#ga3da532852cd9b246326d832e3ae265a1">JUNO_STATUS_INVALID_TYPE_ERROR</a>);</div>
<div class="line">    <span class="comment">// Verify the pointer</span></div>
<div class="line">    tStatus = <a class="code hl_define" href="engine__cmd__msg_8h.html#a81c51ba859ed61b8911125bab624baa1">EngineCmdMsg_PointerVerify</a>(tItem);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Check if the index is valid</span></div>
<div class="line">    tStatus = <a class="code hl_function" href="group__juno__ds__array.html#gadb5ad263e21e298fe62b9434ad3bf598">JunoDs_ArrayVerifyIndex</a>(ptArray, iIndex);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Cast to the pipe type</span></div>
<div class="line">    ENGINE_CMD_MSG_ARRAY_T *ptEngineCmdMsgPipe = (ENGINE_CMD_MSG_ARRAY_T *)ptArray;</div>
<div class="line">    <span class="comment">// Init the pointer to the buffer</span></div>
<div class="line">    <a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tIndexPointer = <a class="code hl_define" href="engine__cmd__msg_8h.html#a69669b266b04a70fdf92cdf9bd4243b2">EngineCmdMsg_PointerInit</a>(&amp;ptEngineCmdMsgPipe-&gt;ptArrEngineCmdMsgBuffer[iIndex]);</div>
<div class="line">    <span class="comment">// Copy the memory to the buffer</span></div>
<div class="line">    tStatus = tIndexPointer.ptApi-&gt;Copy(tIndexPointer, tItem);</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> JUNO_RESULT_POINTER_T <a class="code hl_function" href="engine__cmd__msg_8c.html#a88329cf757f301650d991196efd61e6c">GetAt</a>(<a class="code hl_typedef" href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a> *ptArray, <span class="keywordtype">size_t</span> iIndex)</div>
<div class="line">{</div>
<div class="line">    JUNO_RESULT_POINTER_T tResult = {0};</div>
<div class="line">    <span class="comment">// Verify the array</span></div>
<div class="line">    tResult.tStatus = <a class="code hl_function" href="group__juno__ds__array.html#gad855ed7dd372ff5fc608aee1408e3b0d">JunoDs_ArrayVerify</a>(ptArray);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tResult.tStatus, <span class="keywordflow">return</span> tResult);</div>
<div class="line">    <span class="comment">// Assert the api</span></div>
<div class="line">    <a class="code hl_define" href="engine__cmd__msg_8c.html#a7404ae4d7923c5f52d71f9d8d220fcd5">ENGINE_CMD_MSG_PIPE_ASSERT_API</a>(ptArray,</div>
<div class="line">        tResult.tStatus = <a class="code hl_define" href="group__juno__status__codes.html#ga3da532852cd9b246326d832e3ae265a1">JUNO_STATUS_INVALID_TYPE_ERROR</a>;</div>
<div class="line">        <span class="keywordflow">return</span> tResult;</div>
<div class="line">    );</div>
<div class="line">    <span class="comment">// Check the index</span></div>
<div class="line">    tResult.tStatus = <a class="code hl_function" href="group__juno__ds__array.html#gadb5ad263e21e298fe62b9434ad3bf598">JunoDs_ArrayVerifyIndex</a>(ptArray, iIndex);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tResult.tStatus, <span class="keywordflow">return</span> tResult);</div>
<div class="line">    <span class="comment">// Cast to the pipe type</span></div>
<div class="line">    ENGINE_CMD_MSG_ARRAY_T *ptEngineCmdMsgPipe = (ENGINE_CMD_MSG_ARRAY_T *)ptArray;</div>
<div class="line">    <span class="comment">// Create the pointer to the buffer</span></div>
<div class="line">    <a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tIndexPointer = <a class="code hl_define" href="engine__cmd__msg_8h.html#a69669b266b04a70fdf92cdf9bd4243b2">EngineCmdMsg_PointerInit</a>(&amp;ptEngineCmdMsgPipe-&gt;ptArrEngineCmdMsgBuffer[iIndex]);</div>
<div class="line">    <span class="comment">// Copy to ok result</span></div>
<div class="line">    tResult.tOk = tIndexPointer;</div>
<div class="line">    <span class="keywordflow">return</span> tResult;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__cmd__msg_8c.html#a4fe3c6e1764c332957ad42d8f0655a9f">RemoveAt</a>(<a class="code hl_typedef" href="array__api_8h.html#a41c3dcd3aa4c045b5ca6794251257183">JUNO_DS_ARRAY_ROOT_T</a> *ptArray, <span class="keywordtype">size_t</span> iIndex)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Verify the array</span></div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_function" href="group__juno__ds__array.html#gad855ed7dd372ff5fc608aee1408e3b0d">JunoDs_ArrayVerify</a>(ptArray);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Assert the api</span></div>
<div class="line">    <a class="code hl_define" href="engine__cmd__msg_8c.html#a7404ae4d7923c5f52d71f9d8d220fcd5">ENGINE_CMD_MSG_PIPE_ASSERT_API</a>(ptArray, <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#ga3da532852cd9b246326d832e3ae265a1">JUNO_STATUS_INVALID_TYPE_ERROR</a>);</div>
<div class="line">    <span class="comment">// Verify the index</span></div>
<div class="line">    tStatus = <a class="code hl_function" href="group__juno__ds__array.html#gadb5ad263e21e298fe62b9434ad3bf598">JunoDs_ArrayVerifyIndex</a>(ptArray, iIndex);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="comment">// Cast to the msg pipe type</span></div>
<div class="line">    ENGINE_CMD_MSG_ARRAY_T *ptEngineCmdMsgPipe = (ENGINE_CMD_MSG_ARRAY_T *)ptArray;</div>
<div class="line">    <span class="comment">// Create pointer to memory</span></div>
<div class="line">    <a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tIndexPointer = <a class="code hl_define" href="engine__cmd__msg_8h.html#a69669b266b04a70fdf92cdf9bd4243b2">EngineCmdMsg_PointerInit</a>(&amp;ptEngineCmdMsgPipe-&gt;ptArrEngineCmdMsgBuffer[iIndex]);</div>
<div class="line">    <span class="comment">// Reset the memory</span></div>
<div class="line">    tStatus = tIndexPointer.ptApi-&gt;Reset(tIndexPointer);</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
<div class="ttc" id="aengine__cmd__msg_8c_html_a7404ae4d7923c5f52d71f9d8d220fcd5"><div class="ttname"><a href="engine__cmd__msg_8c.html#a7404ae4d7923c5f52d71f9d8d220fcd5">ENGINE_CMD_MSG_PIPE_ASSERT_API</a></div><div class="ttdeci">#define ENGINE_CMD_MSG_PIPE_ASSERT_API(ptArray,...)</div><div class="ttdoc">Asserts the api is for the pipe.</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.c:104</div></div>
<div class="ttc" id="aengine__cmd__msg_8h_html_a69669b266b04a70fdf92cdf9bd4243b2"><div class="ttname"><a href="engine__cmd__msg_8h.html#a69669b266b04a70fdf92cdf9bd4243b2">EngineCmdMsg_PointerInit</a></div><div class="ttdeci">#define EngineCmdMsg_PointerInit(addr)</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.h:85</div></div>
<div class="ttc" id="agroup__juno__ds__array_html_gad855ed7dd372ff5fc608aee1408e3b0d"><div class="ttname"><a href="group__juno__ds__array.html#gad855ed7dd372ff5fc608aee1408e3b0d">JunoDs_ArrayVerify</a></div><div class="ttdeci">static JUNO_STATUS_T JunoDs_ArrayVerify(const JUNO_DS_ARRAY_ROOT_T *ptArray)</div><div class="ttdoc">Verify an array instance's capacity and API.</div><div class="ttdef"><b>Definition</b> array_api.h:117</div></div>
<div class="ttc" id="agroup__juno__ds__array_html_gadb5ad263e21e298fe62b9434ad3bf598"><div class="ttname"><a href="group__juno__ds__array.html#gadb5ad263e21e298fe62b9434ad3bf598">JunoDs_ArrayVerifyIndex</a></div><div class="ttdeci">static JUNO_STATUS_T JunoDs_ArrayVerifyIndex(const JUNO_DS_ARRAY_ROOT_T *ptArray, size_t iIndex)</div><div class="ttdoc">Verify an index is within array capacity.</div><div class="ttdef"><b>Definition</b> array_api.h:136</div></div>
<div class="ttc" id="agroup__juno__status__codes_html_ga3da532852cd9b246326d832e3ae265a1"><div class="ttname"><a href="group__juno__status__codes.html#ga3da532852cd9b246326d832e3ae265a1">JUNO_STATUS_INVALID_TYPE_ERROR</a></div><div class="ttdeci">#define JUNO_STATUS_INVALID_TYPE_ERROR</div><div class="ttdoc">Provided type or trait did not match the expected one.</div><div class="ttdef"><b>Definition</b> status.h:66</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md100"></a>
engine_app.c</h1>
<p>Next we need to implement the application. <code><a class="el" href="engine__app_8c.html">engine_app.c</a></code> will act as a composition root for application specific logic. This means that the application can own some dependencies, like its message buffers and pipes. The line between dependencies an application should own and dependencies the <code><a class="el" href="main_8c.html">main.c</a></code> root should own is fuzzy. It depends on developers specific use cases. In general, items like the pipes, memory buffers, and application specific dependencies should be owned by the application. Dependencies that reach to more than one application should be owned by the project composition root (<code><a class="el" href="main_8c.html">main.c</a></code>).</p>
<h2><a class="anchor" id="autotoc_md101"></a>
Application Api</h2>
<p>As stated previously, LibJuno applications are derived from the <code>JUNO_APP_ROOT_T</code>. This means we need to implement the API defined by the root module. We forward declare the api functions and the verification function so we can check and verify that the pointer being passed to our function is in fact a <code>ENGINE_APP_T</code> type by asserting that the api pointers match.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="juno__memory__block_8c.html#a3352a5e98b18606f4e598c3f8cfe99b8">Verify</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp);</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8c.html#a31372170184dafe88f485ed00dfe9880">OnStart</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp);</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8c.html#a297bfb3df9e7464b62b51373f81821b6">OnProcess</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp);</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8c.html#ab5f25ef6e9570765227504a16257117f">OnExit</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__APP__API__TAG.html">JUNO_APP_API_T</a> <a class="code hl_variable" href="engine__app_8c.html#ad61a94e46e9c230dccc823937829118a">tEngineAppApi</a> = {</div>
<div class="line">    .<a class="code hl_variable" href="structJUNO__APP__API__TAG.html#a0ad5e3c5b5e1afd9d79473a1634ce3a8">OnStart</a> = <a class="code hl_function" href="engine__app_8c.html#a31372170184dafe88f485ed00dfe9880">OnStart</a>,</div>
<div class="line">    .OnProcess = <a class="code hl_function" href="engine__app_8c.html#a297bfb3df9e7464b62b51373f81821b6">OnProcess</a>,</div>
<div class="line">    .OnExit = <a class="code hl_function" href="engine__app_8c.html#ab5f25ef6e9570765227504a16257117f">OnExit</a></div>
<div class="line">};</div>
<div class="ttc" id="aengine__app_8c_html_a297bfb3df9e7464b62b51373f81821b6"><div class="ttname"><a href="engine__app_8c.html#a297bfb3df9e7464b62b51373f81821b6">OnProcess</a></div><div class="ttdeci">static JUNO_STATUS_T OnProcess(JUNO_APP_ROOT_T *ptJunoApp)</div><div class="ttdef"><b>Definition</b> engine_app.c:168</div></div>
<div class="ttc" id="aengine__app_8c_html_a31372170184dafe88f485ed00dfe9880"><div class="ttname"><a href="engine__app_8c.html#a31372170184dafe88f485ed00dfe9880">OnStart</a></div><div class="ttdeci">static JUNO_STATUS_T OnStart(JUNO_APP_ROOT_T *ptJunoApp)</div><div class="ttdef"><b>Definition</b> engine_app.c:128</div></div>
<div class="ttc" id="aengine__app_8c_html_ab5f25ef6e9570765227504a16257117f"><div class="ttname"><a href="engine__app_8c.html#ab5f25ef6e9570765227504a16257117f">OnExit</a></div><div class="ttdeci">static JUNO_STATUS_T OnExit(JUNO_APP_ROOT_T *ptJunoApp)</div><div class="ttdef"><b>Definition</b> engine_app.c:248</div></div>
<div class="ttc" id="aengine__app_8c_html_ad61a94e46e9c230dccc823937829118a"><div class="ttname"><a href="engine__app_8c.html#ad61a94e46e9c230dccc823937829118a">tEngineAppApi</a></div><div class="ttdeci">static const JUNO_APP_API_T tEngineAppApi</div><div class="ttdef"><b>Definition</b> engine_app.c:54</div></div>
<div class="ttc" id="ajuno__memory__block_8c_html_a3352a5e98b18606f4e598c3f8cfe99b8"><div class="ttname"><a href="juno__memory__block_8c.html#a3352a5e98b18606f4e598c3f8cfe99b8">Verify</a></div><div class="ttdeci">static JUNO_STATUS_T Verify(JUNO_MEMORY_ALLOC_ROOT_T *ptJunoMemory)</div><div class="ttdef"><b>Definition</b> juno_memory_block.c:26</div></div>
<div class="ttc" id="astructJUNO__APP__API__TAG_html"><div class="ttname"><a href="structJUNO__APP__API__TAG.html">JUNO_APP_API_TAG</a></div><div class="ttdef"><b>Definition</b> app_api.h:55</div></div>
<div class="ttc" id="astructJUNO__APP__API__TAG_html_a0ad5e3c5b5e1afd9d79473a1634ce3a8"><div class="ttname"><a href="structJUNO__APP__API__TAG.html#a0ad5e3c5b5e1afd9d79473a1634ce3a8">JUNO_APP_API_TAG::OnStart</a></div><div class="ttdeci">JUNO_STATUS_T(* OnStart)(JUNO_APP_ROOT_T *ptJunoApp)</div><div class="ttdoc">Called once to initialize resources before processing.</div><div class="ttdef"><b>Definition</b> app_api.h:57</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md102"></a>
Verification Function</h2>
<p>The verification function is called as the one of the very first lines in a LibJuno API function. Its purpose is to assert that the module contract is met. This means that pointers are initialized, and the APIs match.</p>
<p>In LibJuno we can use <code>JUNO_ASSERT</code> macros that will check for certain common conditions like null pointers. These macros will automatically return <code>JUNO_STATUS_ERR</code> or <code>JUNO_STATUS_NULLPTR_ERROR</code> on failure.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="juno__memory__block_8c.html#a3352a5e98b18606f4e598c3f8cfe99b8">Verify</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Assert the pointer is not null</span></div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#ga30286e0b0863a08e3a9c0151c698acc4">JUNO_ASSERT_EXISTS</a>(ptJunoApp);</div>
<div class="line">    <span class="comment">// Cast to the engine app</span></div>
<div class="line">    <a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *ptEngineApp = (<a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *)(ptJunoApp);</div>
<div class="line">    <span class="comment">// Assert the module dependencies are present</span></div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#ga66c0cdce818768d381d0e8e480ea24aa">JUNO_ASSERT_EXISTS_MODULE</a>(</div>
<div class="line">        <span class="comment">/* TODO: Assert other dependencies and members here using &amp;&amp;*/</span></div>
<div class="line">        ptEngineApp &amp;&amp;</div>
<div class="line">        ptEngineApp-&gt;tRoot.ptApi &amp;&amp;</div>
<div class="line">        ptEngineApp-&gt;ptLogger &amp;&amp;</div>
<div class="line">        ptEngineApp-&gt;ptTime &amp;&amp;</div>
<div class="line">        ptEngineApp-&gt;ptBroker,</div>
<div class="line">        ptEngineApp,</div>
<div class="line">        <span class="stringliteral">&quot;Module does not have all dependencies&quot;</span></div>
<div class="line">    );</div>
<div class="line">    <span class="comment">// Verify that this application is using the correct API</span></div>
<div class="line">    <span class="keywordflow">if</span>(ptEngineApp-&gt;tRoot.ptApi != &amp;<a class="code hl_variable" href="engine__app_8c.html#ad61a94e46e9c230dccc823937829118a">tEngineAppApi</a>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="group__juno__status.html#ga45c2dc85533ae2d7cb60ba543390afee">JUNO_FAIL_MODULE</a>(<a class="code hl_define" href="group__juno__status__codes.html#ga3da532852cd9b246326d832e3ae265a1">JUNO_STATUS_INVALID_TYPE_ERROR</a>, ptEngineApp, <span class="stringliteral">&quot;Module has invalid API&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#ga3da532852cd9b246326d832e3ae265a1">JUNO_STATUS_INVALID_TYPE_ERROR</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__juno__macros_html_ga66c0cdce818768d381d0e8e480ea24aa"><div class="ttname"><a href="group__juno__macros.html#ga66c0cdce818768d381d0e8e480ea24aa">JUNO_ASSERT_EXISTS_MODULE</a></div><div class="ttdeci">#define JUNO_ASSERT_EXISTS_MODULE(ptr, ptMod, str)</div><div class="ttdoc">Like JUNO_ASSERT_EXISTS but also calls the module's failure handler.</div><div class="ttdef"><b>Definition</b> macros.h:66</div></div>
<div class="ttc" id="agroup__juno__status_html_ga45c2dc85533ae2d7cb60ba543390afee"><div class="ttname"><a href="group__juno__status.html#ga45c2dc85533ae2d7cb60ba543390afee">JUNO_FAIL_MODULE</a></div><div class="ttdeci">#define JUNO_FAIL_MODULE(tStatus, ptMod, pcMessage)</div><div class="ttdoc">Invoke a module instance's failure handler if available.</div><div class="ttdef"><b>Definition</b> status.h:138</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md103"></a>
The Application Init Function</h2>
<p>The init function's primary responsibility is to assign dependencies. This function enables the <code><a class="el" href="main_8c.html">main.c</a></code> project composition root to pass application dependencies to the application. This function is a concrete implementation because it depends entirely on application specifics.</p>
<p>This function asserts the module pointer exists, assigns the dependency pointers, and finally calls the verification function. The verification function is called last because it assumes the pointers have been instantiated.</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8h.html#ac02e2300210188645a8b0fa95c8223d7">EngineApp_Init</a>(<a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *ptJunoApp, <span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptLogger, <span class="keyword">const</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> *ptTime, <a class="code hl_typedef" href="broker__api_8h.html#a18f8e3cdde5d600227ecc8fae74e1dd2">JUNO_SB_BROKER_ROOT_T</a> *ptBroker, <a class="code hl_typedef" href="group__juno__status.html#ga0fbff8c7db15c2f4d01e82b8a863dbbc">JUNO_FAILURE_HANDLER_T</a> pfcnFailureHandler, <a class="code hl_typedef" href="group__juno__status.html#gaf575dc984c80091757afe42a5d5c2b60">JUNO_USER_DATA_T</a> *pvFailureUserData)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#ga30286e0b0863a08e3a9c0151c698acc4">JUNO_ASSERT_EXISTS</a>(ptJunoApp);</div>
<div class="line">    <a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *ptEngineApp = (<a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *)(ptJunoApp);</div>
<div class="line">    ptEngineApp-&gt;tRoot.ptApi = &amp;<a class="code hl_variable" href="engine__app_8c.html#ad61a94e46e9c230dccc823937829118a">tEngineAppApi</a>;</div>
<div class="line">    ptEngineApp-&gt;tRoot.JUNO_FAILURE_HANDLER = pfcnFailureHandler;</div>
<div class="line">    ptEngineApp-&gt;tRoot.JUNO_FAILURE_USER_DATA = pvFailureUserData;</div>
<div class="line">    ptEngineApp-&gt;ptLogger = ptLogger;</div>
<div class="line">    ptEngineApp-&gt;ptTime = ptTime;</div>
<div class="line">    ptEngineApp-&gt;ptBroker = ptBroker;</div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_function" href="juno__memory__block_8c.html#a3352a5e98b18606f4e598c3f8cfe99b8">Verify</a>(&amp;ptJunoApp-&gt;tRoot);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md104"></a>
&lt;tt&gt;OnStart&lt;/tt&gt;</h2>
<p><code>OnStart</code> is the very first function called in a LibJuno project and is typically called only once. The primary purpose of <code>OnStart</code> is to initialize state variables, perform initialization tasks specific to the application, and allocate global application resources.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8c.html#a31372170184dafe88f485ed00dfe9880">OnStart</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">    tStatus = <a class="code hl_function" href="juno__memory__block_8c.html#a3352a5e98b18606f4e598c3f8cfe99b8">Verify</a>(ptJunoApp);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus)</div>
<div class="line">    <span class="comment">// Cast to the engine app</span></div>
<div class="line">    <a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *ptEngineApp = (<a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *)(ptJunoApp);</div>
<div class="line">    <span class="comment">// Get the logger</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptLogger = ptEngineApp-&gt;ptLogger;</div>
<div class="line">    <span class="comment">// Get the logger api</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__LOG__API__TAG.html">JUNO_LOG_API_T</a> *ptLoggerApi = ptLogger-&gt;ptApi;</div>
<div class="line">    <span class="comment">// Log that the app was intialized</span></div>
<div class="line">    ptLoggerApi-&gt;<a class="code hl_variable" href="structJUNO__LOG__API__TAG.html#aefd3b900918e78f012a8637e9533a3df">LogInfo</a>(ptLogger, <span class="stringliteral">&quot;Engine App Initialized&quot;</span>);</div>
<div class="line">    <span class="comment">// Initialize the cmd pipe</span></div>
<div class="ttc" id="astructJUNO__LOG__API__TAG_html_aefd3b900918e78f012a8637e9533a3df"><div class="ttname"><a href="structJUNO__LOG__API__TAG.html#aefd3b900918e78f012a8637e9533a3df">JUNO_LOG_API_TAG::LogInfo</a></div><div class="ttdeci">JUNO_STATUS_T(* LogInfo)(const JUNO_LOG_ROOT_T *ptJunoLog, const char *pcMsg,...)</div><div class="ttdoc">Log an info-level message.</div><div class="ttdef"><b>Definition</b> log_api.h:58</div></div>
</div><!-- fragment --><p>Within <code>OnStart</code> we will initialize our command message pipe so we can receive commands. We will also register this pipe with the broker so it can be active.</p>
<div class="fragment"><div class="line">tStatus = <a class="code hl_function" href="engine__cmd__msg_8h.html#aed9dcce9c4c3393aebc522a2d5bd4d68">EngineCmdMsg_ArrayInit</a>(&amp;ptEngineApp-&gt;tCmdArray, ptEngineApp-&gt;ptArrCmdBuffer, <a class="code hl_define" href="engine__app_8h.html#a6528d7a500b07e3c59309ecb7406beb8">ENGINE_CMD_MSG_PIPE_DEPTH</a>, ptJunoApp-&gt;_pfcnFailureHandler, ptJunoApp-&gt;_pvFailureUserData);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line">tStatus = <a class="code hl_function" href="broker__api_8h.html#a185df58fb0477774d4e5b8586861e185">JunoSb_PipeInit</a>(&amp;ptEngineApp-&gt;tCmdPipe, <a class="code hl_define" href="engine__cmd__msg_8h.html#ab9259e4a55c8e8168eb32314116e4127">ENGINE_CMD_MSG_MID</a>, &amp;ptEngineApp-&gt;tCmdArray.tRoot, ptJunoApp-&gt;_pfcnFailureHandler, ptJunoApp-&gt;_pvFailureUserData);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="line"><span class="comment">// Register the subscriber</span></div>
<div class="line">tStatus = ptEngineApp-&gt;ptBroker-&gt;ptApi-&gt;RegisterSubscriber(ptEngineApp-&gt;ptBroker, &amp;ptEngineApp-&gt;tCmdPipe);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus);</div>
<div class="ttc" id="abroker__api_8h_html_a185df58fb0477774d4e5b8586861e185"><div class="ttname"><a href="broker__api_8h.html#a185df58fb0477774d4e5b8586861e185">JunoSb_PipeInit</a></div><div class="ttdeci">static JUNO_STATUS_T JunoSb_PipeInit(JUNO_SB_PIPE_T *ptPipe, JUNO_SB_MID_T iMid, JUNO_DS_ARRAY_ROOT_T *ptArray, JUNO_FAILURE_HANDLER_T pfcnFailureHandler, JUNO_USER_DATA_T *pvUserData)</div><div class="ttdoc">Initialize a pipe for a specific MID backed by a queue over ptArray.</div><div class="ttdef"><b>Definition</b> broker_api.h:132</div></div>
<div class="ttc" id="aengine__cmd__msg_8h_html_ab9259e4a55c8e8168eb32314116e4127"><div class="ttname"><a href="engine__cmd__msg_8h.html#ab9259e4a55c8e8168eb32314116e4127">ENGINE_CMD_MSG_MID</a></div><div class="ttdeci">#define ENGINE_CMD_MSG_MID</div><div class="ttdef"><b>Definition</b> engine_cmd_msg.h:45</div></div>
</div><!-- fragment --><p>For this example we will also set the current RPM to 0</p>
<div class="fragment"><div class="line">    <span class="comment">// Initialize current RPM to 0</span></div>
<div class="line">    ptEngineApp-&gt;fCurrentRpm = 0.0;</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md105"></a>
&lt;tt&gt;OnProcess&lt;/tt&gt;</h2>
<p>OnProcess is the main run-loop function of the application. It is called on a periodic basis, typically at a set frequency (like 1Hz, 5Hz, 50Hz, 100Hz, etc).</p>
<p>This is where the main functionality of the application will reside.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8c.html#a297bfb3df9e7464b62b51373f81821b6">OnProcess</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">    tStatus = <a class="code hl_function" href="juno__memory__block_8c.html#a3352a5e98b18606f4e598c3f8cfe99b8">Verify</a>(ptJunoApp);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus)</div>
<div class="line">    <span class="comment">// Cast to the engine app</span></div>
<div class="line">    <a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *ptEngineApp = (<a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *)(ptJunoApp);</div>
<div class="line">    <span class="comment">// Get the logger</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptLogger = ptEngineApp-&gt;ptLogger;</div>
<div class="line">    <span class="comment">// Get the logger api</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__LOG__API__TAG.html">JUNO_LOG_API_T</a> *ptLoggerApi = ptLogger-&gt;ptApi;</div>
<div class="line">    <span class="comment">// Get the broker</span></div>
<div class="line">    <a class="code hl_typedef" href="broker__api_8h.html#a18f8e3cdde5d600227ecc8fae74e1dd2">JUNO_SB_BROKER_ROOT_T</a> *ptBroker = ptEngineApp-&gt;ptBroker;</div>
<div class="line">    <span class="comment">// Get the time api</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_typedef" href="group__juno__time.html#gaefeb9d6509263f33b8586b99ae66bcac">JUNO_TIME_ROOT_T</a> *ptTime = ptEngineApp-&gt;ptTime;</div>
<div class="line">    <span class="comment">// Log that the app is running</span></div>
<div class="line">    ptLoggerApi-&gt;<a class="code hl_variable" href="structJUNO__LOG__API__TAG.html#aeb29dca837a71395af86864e6a7f9ed5">LogDebug</a>(ptLogger, <span class="stringliteral">&quot;Engine App Running&quot;</span>);</div>
<div class="ttc" id="astructJUNO__LOG__API__TAG_html_aeb29dca837a71395af86864e6a7f9ed5"><div class="ttname"><a href="structJUNO__LOG__API__TAG.html#aeb29dca837a71395af86864e6a7f9ed5">JUNO_LOG_API_TAG::LogDebug</a></div><div class="ttdeci">JUNO_STATUS_T(* LogDebug)(const JUNO_LOG_ROOT_T *ptJunoLog, const char *pcMsg,...)</div><div class="ttdoc">Log a debug-level message (most verbose).</div><div class="ttdef"><b>Definition</b> log_api.h:56</div></div>
</div><!-- fragment --><p>In this example we will sleep the application for 500ms to simulate extensive work being done within the application. We will also create a convenience variable to access the pipe's queue API.</p>
<div class="fragment"><div class="line"><span class="comment">// sleep for half a second</span></div>
<div class="line">usleep(500E3);</div>
<div class="line"><span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__DS__QUEUE__API__TAG.html">JUNO_DS_QUEUE_API_T</a> *ptCmdPipeApi = ptEngineApp-&gt;tCmdPipe.tRoot.ptApi;</div>
<div class="ttc" id="astructJUNO__DS__QUEUE__API__TAG_html"><div class="ttname"><a href="structJUNO__DS__QUEUE__API__TAG.html">JUNO_DS_QUEUE_API_TAG</a></div><div class="ttdoc">Queue API vtable.</div><div class="ttdef"><b>Definition</b> queue_api.h:84</div></div>
</div><!-- fragment --><p>For this example we will allocate a buffer to attempt to receive a command from the message pipe. We will then initialize an engine command pointer with the address to our allocated buffer.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> tEngineCmd = {0};</div>
<div class="line"><a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tEngineCmdPointer = <a class="code hl_define" href="engine__cmd__msg_8h.html#a69669b266b04a70fdf92cdf9bd4243b2">EngineCmdMsg_PointerInit</a>(&amp;tEngineCmd);</div>
</div><!-- fragment --><p>We will then get the current timestamp using the time api provided by the project root.</p>
<div class="fragment"><div class="line">JUNO_TIMESTAMP_RESULT_T tTimestampResult = ptTime-&gt;ptApi-&gt;Now(ptTime);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tTimestampResult.tStatus, <span class="keywordflow">return</span> tTimestampResult.tStatus);</div>
</div><!-- fragment --><p>Next we initialize a telemetry message with the current RPM and timestamp. This is done at this step because in the case of an error, we will jump to the <code>exit</code> point with a <code>goto</code> statement so we always publish this telemetry.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structENGINE__TLM__MSG__TAG.html">ENGINE_TLM_MSG_T</a> tEngineTlm = {ptEngineApp-&gt;fCurrentRpm, tTimestampResult.tOk};</div>
<div class="line"><a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tEngineTlmPointer = <a class="code hl_define" href="engine__tlm__msg_8h.html#ac6b68578f45fa1e48304b213cd9131b4">EngineTlmMsg_PointerInit</a>(&amp;tEngineTlm);</div>
<div class="ttc" id="aengine__tlm__msg_8h_html_ac6b68578f45fa1e48304b213cd9131b4"><div class="ttname"><a href="engine__tlm__msg_8h.html#ac6b68578f45fa1e48304b213cd9131b4">EngineTlmMsg_PointerInit</a></div><div class="ttdeci">#define EngineTlmMsg_PointerInit(addr)</div><div class="ttdef"><b>Definition</b> engine_tlm_msg.h:46</div></div>
<div class="ttc" id="astructENGINE__TLM__MSG__TAG_html"><div class="ttname"><a href="structENGINE__TLM__MSG__TAG.html">ENGINE_TLM_MSG_TAG</a></div><div class="ttdef"><b>Definition</b> engine_tlm_msg.h:34</div></div>
</div><!-- fragment --><p>We will calculate some artificial noise to simulate an actual sensor measurement.</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> noise = rand();</div>
<div class="line">noise = noise - RAND_MAX/2;</div>
<div class="line">noise = 2 * noise / RAND_MAX;</div>
</div><!-- fragment --><p>Next we will attempt to dequeue a command from the software bus. This operation will fail if there is no command in the pipe and will jump to the exit point of this function.</p>
<div class="fragment"><div class="line">    tStatus = ptCmdPipeApi-&gt;<a class="code hl_variable" href="structJUNO__DS__QUEUE__API__TAG.html#ae5a6e967157e4c596c6b42c209217547">Dequeue</a>(&amp;ptEngineApp-&gt;tCmdPipe.tRoot, tEngineCmdPointer);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">goto</span> exit);</div>
<div class="line"><span class="comment">/*DOC</span></div>
<div class="line"><span class="comment">Because we has a `JUNO_ASSERT_SUCCESS` on the previous function, we know that at this point</span></div>
<div class="line"><span class="comment">in the software the `dequeue` succeeded and the command buffer we provided has been populated</span></div>
<div class="line"><span class="comment">with an RPM. We will set that to the current RPM</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">    ptEngineApp-&gt;fCurrentRpm = tEngineCmd.<a class="code hl_variable" href="structENGINE__CMD__MSG__TAG.html#ade3188a8fb0c5c7cbd0a058e48b0f115">fRpm</a>;</div>
<div class="line">    ptLoggerApi-&gt;<a class="code hl_variable" href="structJUNO__LOG__API__TAG.html#aefd3b900918e78f012a8637e9533a3df">LogInfo</a>(ptLogger, <span class="stringliteral">&quot;RPM Commanded to: %f&quot;</span>, tEngineCmd.<a class="code hl_variable" href="structENGINE__CMD__MSG__TAG.html#ade3188a8fb0c5c7cbd0a058e48b0f115">fRpm</a>);</div>
<div class="ttc" id="astructJUNO__DS__QUEUE__API__TAG_html_ae5a6e967157e4c596c6b42c209217547"><div class="ttname"><a href="structJUNO__DS__QUEUE__API__TAG.html#ae5a6e967157e4c596c6b42c209217547">JUNO_DS_QUEUE_API_TAG::Dequeue</a></div><div class="ttdeci">JUNO_STATUS_T(* Dequeue)(JUNO_DS_QUEUE_ROOT_T *ptQueue, JUNO_POINTER_T tReturn)</div><div class="ttdoc">Dequeue the item at the front of the queue.</div><div class="ttdef"><b>Definition</b> queue_api.h:94</div></div>
</div><!-- fragment --><p>Finally we will add some noise to the current RPM in all cases to simulate a real measurement and publish the telemetry.</p>
<div class="fragment"><div class="line">exit:</div>
<div class="line">    tEngineTlm.<a class="code hl_variable" href="structENGINE__TLM__MSG__TAG.html#aedebc7be5f761ea2804eb85ad750ecb7">fRpm</a> = ptEngineApp-&gt;fCurrentRpm + 10*noise;</div>
<div class="line">    ptBroker-&gt;ptApi-&gt;Publish(ptBroker, <a class="code hl_define" href="engine__tlm__msg_8h.html#a0d24028b8e507a856d1b261d6049fda6">ENGINE_TLM_MSG_MID</a>, tEngineTlmPointer);</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
<div class="ttc" id="aengine__tlm__msg_8h_html_a0d24028b8e507a856d1b261d6049fda6"><div class="ttname"><a href="engine__tlm__msg_8h.html#a0d24028b8e507a856d1b261d6049fda6">ENGINE_TLM_MSG_MID</a></div><div class="ttdeci">#define ENGINE_TLM_MSG_MID</div><div class="ttdef"><b>Definition</b> engine_tlm_msg.h:31</div></div>
<div class="ttc" id="astructENGINE__TLM__MSG__TAG_html_aedebc7be5f761ea2804eb85ad750ecb7"><div class="ttname"><a href="structENGINE__TLM__MSG__TAG.html#aedebc7be5f761ea2804eb85ad750ecb7">ENGINE_TLM_MSG_TAG::fRpm</a></div><div class="ttdeci">float fRpm</div><div class="ttdef"><b>Definition</b> engine_tlm_msg.h:36</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md106"></a>
&lt;tt&gt;OnExit&lt;/tt&gt;</h2>
<p>The <code>OnExit</code> function is typically the last function called in the application. It is used to clean-up globally allocated resources like sockets and file descriptors before the main run-time exits. This application does not have any resources to clean up so it just exits.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> <a class="code hl_function" href="engine__app_8c.html#ab5f25ef6e9570765227504a16257117f">OnExit</a>(<a class="code hl_typedef" href="app__api_8h.html#af4d1371636773a3186696687c684db54">JUNO_APP_ROOT_T</a> *ptJunoApp)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__juno__status.html#ga37f8e6b135f0c1a21a3a34b19d1772aa">JUNO_STATUS_T</a> tStatus = <a class="code hl_define" href="group__juno__status__codes.html#gad89a3ea5be5fc21a4b97e2b1e761c084">JUNO_STATUS_SUCCESS</a>;</div>
<div class="line">    tStatus = <a class="code hl_function" href="juno__memory__block_8c.html#a3352a5e98b18606f4e598c3f8cfe99b8">Verify</a>(ptJunoApp);</div>
<div class="line">    <a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">return</span> tStatus)</div>
<div class="line">    <span class="comment">// Cast to the engine app</span></div>
<div class="line">    <a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *ptEngineApp = (<a class="code hl_typedef" href="engine__app_8h.html#adfc71973e68539e8461689f81271a2e8">ENGINE_APP_T</a> *)(ptJunoApp);</div>
<div class="line">    <span class="comment">// Get the logger</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_typedef" href="log__api_8h.html#a006301174348e71fde021a376106f756">JUNO_LOG_ROOT_T</a> *ptLogger = ptEngineApp-&gt;ptLogger;</div>
<div class="line">    <span class="comment">// Get the logger api</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_struct" href="structJUNO__LOG__API__TAG.html">JUNO_LOG_API_T</a> *ptLoggerApi = ptLogger-&gt;ptApi;</div>
<div class="line">    <span class="comment">// Log that the app is running</span></div>
<div class="line">    ptLoggerApi-&gt;<a class="code hl_variable" href="structJUNO__LOG__API__TAG.html#aefd3b900918e78f012a8637e9533a3df">LogInfo</a>(ptLogger, <span class="stringliteral">&quot;Engine App Exiting&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md107"></a>
system_manager_app.c</h1>
<p>The System Manager application for this car example will subscribe to the engine apps's telemetry. Similar to the engine app's command pipe, the system manager will read the telemetry off its telemetry pipe. This is done by allocating a telemetry buffer.</p>
<div class="fragment"><div class="line"><span class="comment">// sleep for half a second</span></div>
<div class="line"><a class="code hl_struct" href="structENGINE__TLM__MSG__TAG.html">ENGINE_TLM_MSG_T</a> tTlmMsg = {0};</div>
<div class="line"><a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tTlmMsgPointer = <a class="code hl_define" href="engine__tlm__msg_8h.html#ac6b68578f45fa1e48304b213cd9131b4">EngineTlmMsg_PointerInit</a>(&amp;tTlmMsg);</div>
</div><!-- fragment --><p>Additionally the system manager will command the engine to certain RPMs. It will create the command and command pointer here.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structENGINE__CMD__MSG__TAG.html">ENGINE_CMD_MSG_T</a> tEngineCmd = {ptSystemManagerApp-&gt;fTargetRpm};</div>
<div class="line"><a class="code hl_typedef" href="pointer__api_8h.html#a3caf7d5b9c47228dcbb289ab1f8a6045">JUNO_POINTER_T</a> tEngineCmdPointer = <a class="code hl_define" href="engine__cmd__msg_8h.html#a69669b266b04a70fdf92cdf9bd4243b2">EngineCmdMsg_PointerInit</a>(&amp;tEngineCmd);</div>
</div><!-- fragment --><p>The system manager will attempt to read telemetry off the software bus from the engine. If there is telemetry it will process it and set a new RPM. If there is no telemetry it will command the engine to the same target as before.</p>
<div class="fragment"><div class="line">JUNO_TIME_MILLIS_RESULT_T tMillisResult = {0};</div>
<div class="line">tStatus = ptSystemManagerApp-&gt;tEngineTlmPipe.tRoot.ptApi-&gt;Dequeue(&amp;ptSystemManagerApp-&gt;tEngineTlmPipe.tRoot, tTlmMsgPointer);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">goto</span> exit);</div>
</div><!-- fragment --><p>The system manager will substract the time from engine start to get an elapsed time. I will then check if the engine is within the target RPM. If it is it will increment the RPM by 10RPM. If not it will send the same target RPM as before.</p>
<div class="fragment"><div class="line">tStatus = ptTime-&gt;ptApi-&gt;SubtractTime(ptTime, &amp;tTlmMsg.<a class="code hl_variable" href="structENGINE__TLM__MSG__TAG.html#a1d37f05531bf8474d4f42aa6b623cc6a">tTimestamp</a>, ptSystemManagerApp-&gt;tEngineStart);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tStatus, <span class="keywordflow">goto</span> exit);</div>
<div class="line">tMillisResult = ptTime-&gt;ptApi-&gt;TimestampToMillis(ptTime, tTlmMsg.<a class="code hl_variable" href="structENGINE__TLM__MSG__TAG.html#a1d37f05531bf8474d4f42aa6b623cc6a">tTimestamp</a>);</div>
<div class="line"><a class="code hl_define" href="group__juno__macros.html#gaef99be367bacf32d7c30b34e43a475b3">JUNO_ASSERT_SUCCESS</a>(tMillisResult.tStatus, <span class="keywordflow">return</span> tMillisResult.tStatus);</div>
<div class="line">ptLoggerApi-&gt;<a class="code hl_variable" href="structJUNO__LOG__API__TAG.html#aefd3b900918e78f012a8637e9533a3df">LogInfo</a>(ptLogger, <span class="stringliteral">&quot;Current Rpm: %f | Time: %ull&quot;</span>, tTlmMsg.<a class="code hl_variable" href="structENGINE__TLM__MSG__TAG.html#aedebc7be5f761ea2804eb85ad750ecb7">fRpm</a>, tMillisResult.tOk);</div>
<div class="line"><span class="keywordflow">if</span>(fabs(tTlmMsg.<a class="code hl_variable" href="structENGINE__TLM__MSG__TAG.html#aedebc7be5f761ea2804eb85ad750ecb7">fRpm</a> - ptSystemManagerApp-&gt;fTargetRpm) &lt; 10.0f)</div>
<div class="line">{</div>
<div class="line">    ptSystemManagerApp-&gt;fTargetRpm += 10.0f;</div>
<div class="line">}</div>
<div class="ttc" id="astructENGINE__TLM__MSG__TAG_html_a1d37f05531bf8474d4f42aa6b623cc6a"><div class="ttname"><a href="structENGINE__TLM__MSG__TAG.html#a1d37f05531bf8474d4f42aa6b623cc6a">ENGINE_TLM_MSG_TAG::tTimestamp</a></div><div class="ttdeci">JUNO_TIMESTAMP_T tTimestamp</div><div class="ttdef"><b>Definition</b> engine_tlm_msg.h:37</div></div>
</div><!-- fragment --><p>Finally the system manager sets the target RPM and publishes the message</p>
<div class="fragment"><div class="line">exit:</div>
<div class="line">    tEngineCmd.<a class="code hl_variable" href="structENGINE__CMD__MSG__TAG.html#ade3188a8fb0c5c7cbd0a058e48b0f115">fRpm</a> = ptSystemManagerApp-&gt;fTargetRpm;</div>
<div class="line">    tStatus = ptBroker-&gt;ptApi-&gt;Publish(ptBroker, <a class="code hl_define" href="engine__cmd__msg_8h.html#ab9259e4a55c8e8168eb32314116e4127">ENGINE_CMD_MSG_MID</a>, tEngineCmdPointer);</div>
<div class="line">    <span class="keywordflow">return</span> tStatus;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md108"></a>
Conclusion</h1>
<p>Hopefully this tutorial helped demonstrate how to utilize the LibJuno micro-framework within a software project. Its intent is to provide a toolbox to developers of interfaces and implementations that they can choose to use. Ultimately the developers will implement solutions targeted for their project so much of the architecture is dependent on specific project needs that can't possibly be captured here. This example project is to showcase the various capabilities a user can choose to implement.</p>
<div class="fragment"></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
